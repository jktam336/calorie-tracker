const db = require('../models/foodModels');

const foodController = {};

foodController.getFood = (req, res, next) => {
  const text  = 'SELECT * FROM "public"."foodTest2"';
  // const text  = 'SELECT people.*, species.name species, planets.name homeworld FROM people LEFT OUTER JOIN species ON species._id = people.species_id LEFT OUTER JOIN planets ON planets._id = people.homeworld_id';
  db
    .query(text)
    .then(data => {
      res.locals.foodEntries = data.rows;
      // console.log(data.rows);
      next();
    })
    .catch(e => next(e));
};


foodController.getSpecies = (req, res, next) => {
  // write code here
  const text = 'SELECT species.name, species.classification, species.average_height, species.average_lifespan, species.language, planets.name homeworld FROM species INNER JOIN planets ON species.homeworld_id = planets._id WHERE species._id = $1';
  const values = [req.query.id];
  db
    .query(text, values)
    .then(data => {
      console.log(data.rows);
      if (data.rows.length !== 0) res.locals.species = data.rows;
      else res.locals.species = [{
        classification: 'unknown',
        average_height: 'unknown',
        average_lifespan: 'unknown',
        language: 'unknown',
        homeworld: 'unknown'
      }];
      next();
    })
    .catch(e => next(e));
};

foodController.getHomeworld = (req, res, next) => {
  // write code here
  const text = 'SELECT planets.name, planets.rotation_period, planets.orbital_period, planets.diameter, planets.climate, planets.gravity, planets.terrain, planets.surface_water, planets.population FROM planets WHERE planets._id = $1';
  const values = [req.query.id];
  db
    .query(text, values)
    .then(data => {
      console.log(data.rows);
      if (data.rows.length !== 0) res.locals.homeworld = data.rows;
      else res.locals.homeworld = [{
        rotation_period: 'unknown',
        orbital_period: 'unknown',
        diameter: 'unknown',
        climate: 'unknown',
        gravity: 'unknown',
        terrain: 'unknown',
        surface_water: 'unknown',
        population: 'unknown'
      }]; 
      next();
    })
    .catch(e => next(e));
};


foodController.addFood = (req, res, next) => {
  // console.log(`this is req.body:`, req.body);
  // destructure req.body into column names
  const {name, serving_size, calories, fat = 0, cholesterol = 0, sodium = 0, carbohydrates = 0, fiber = 0, sugars = 0, protein = 0, last_serving = 0} = req.body;
  // console.log(name, serving_size, calories, fat, cholesterol, sodium, carbohydrates, fiber, sugars, protein, last_serving);
  // postgreSQL query string
  const text = `INSERT INTO "public"."foodTest2" (name, serving_size, calories, fat, cholesterol, sodium, carbohydrates, fiber, sugars, protein, last_serving)
  VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11) RETURNING "public"."foodTest2"._id`;
  // query parameters
  const values = [name, serving_size, calories, fat, cholesterol, sodium, carbohydrates, fiber, sugars, protein, last_serving];
  // console.log(`this is values:`, values);

  db
    .query(text, values)
    .then(data => {
      console.log(data),
      next();
    }) 
    .catch(e => next(e));
};

module.exports = foodController;
